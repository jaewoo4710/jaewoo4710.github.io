---
title:  "Contents based filtering"
excerpt: "ë°ì´í„° ë¶„ì„ ë”°ë¼í•˜ê¸°"

toc: true
toc_sticky: true

categories:
  - projects
tags:
  - contents based filtering
last_modified_at: 2020-09-01T08:06:00-05:00
---



# 1. ë°ì´í„° ë¶„ì„ ë¬´ì‘ì • ë”°ë¼í•˜ê¸°
í•™ìƒì´ë¼ë©´ ì•„ë‹ˆ ì•„ë§ˆ ëŒ€ë¶€ë¶„ì˜ ì‚¬ëŒë“¤ì€ ê³µë¶€ë¥¼ ì–´ë–»ê²Œ í•´ì•¼í•˜ë‚˜? ë¼ëŠ” ì§ˆë¬¸ì„ ì•ˆê³  ì‚´ê³  ìˆë‹¤. ë‚´ê°€ ê³ ë“±í•™êµ 3í•™ë…„ì¼ ë•Œ, ì§€ì˜¥ê°™ë˜ í•˜ë£¨ ë“¤ì„ ì°¸ì•„ë‚´ë©´ì„œ ê³µë¶€í•˜ë©° ê¿ˆì„ ê¾¸ë˜ ê³µë¶€ ë³´ë‹¨ ììœ ë¥¼ ê°€ì§„ ëŒ€í•™ìƒ, ì„±ì¸ì´ ì•„ë‹Œ ì—¬ì „íˆ ê³µë¶€í•˜ê³  ìˆëŠ” ì§€ê¸ˆì˜ ë‚´ ëª¨ìŠµë§Œ ë´ë„ ì•Œ ìˆ˜ ìˆë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ì¸ìƒì€ ê³µë¶€ì˜ ì—°ì†ì´ë¼ëŠ” ë§ì— í¬ê²Œ ê³µê°í•  ìˆ˜ ìˆë‹¤. ê·¸ë˜ì„œ ë‚˜ëŠ” ë°ì´í„° ì‚¬ì´ì–¸ìŠ¤ë¥¼ ê³µë¶€í•˜ë©´ì„œ ì¢‹ì€ ì„ ë¡€ì˜ ë°ì´í„° ë¶„ì„ì„ ë”°ë¼í•˜ë©° ê³µë¶€í•˜ê³  ì´í•´í•´ì„œ ê¸°ë¡í•˜ì—¬ ë‚´ ì…ë§›ì— ë§ëŠ” ë‚˜ì˜ ë§ë¡œ ì •ë¦¬í•œ ì±…ì„ ë§Œë“œëŠ” ë°©ë²•ìœ¼ë¡œ ê³µë¶€ë¥¼ ì‹œì‘í•´ í•œê°€ì§€ì˜ ê³µë¶€ë°©ë²•ì„ ì œì‹œí•˜ë ¤ í•œë‹¤. ê·¸ë˜ì„œ [Recommender System with Python](https://lsjsj92.tistory.com/597)  ì—ì„œì˜ ë°ì´í„° ì „ì²˜ë¦¬ ê³¼ì •ì´ ì•„ì£¼ ê°„ë‹¨í•˜ì§€ë§Œ ì•Œë©´ ì—„ì²­ ìœ ìš©í•œ ì½”ë“œ ê°™ì•„ì„œ ì‹¤ì œë¡œ ì ìš©í•´ë³´ë©´ì„œ ì†ì— ìµí˜€ë³´ë ¤ê³  í•œë‹¤.

##   &nbsp; &nbsp;&nbsp; &nbsp;   1.1 Copy ëŒ€ìƒ
&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp; [Recommender System with Python](https://lsjsj92.tistory.com/597) 
&nbsp; &nbsp;  &nbsp; &nbsp; &nbsp;  ì— ì½”ë“œ ë“±ì„ ë°”íƒ•ìœ¼ë¡œ **ë°ì´í„° ì „ì²˜ë¦¬** ê³¼ì •ì˜ ì½”ë“œë¥¼ ë¨¼ì € ì´í•´í•˜ê¸°.

# 2. ë°©ë²•
- ë”°ë¼í•  ëŒ€ìƒì˜ ì½”ë“œë¥¼ ì´í•´í•˜ê³ , ë‚˜ì˜ ë§ë¡œ ë°”ê¿”ë³´ê¸°

# 3. Recommender System with Python ë°ì´í„° ì „ì²˜ë¦¬ ì½”ë“œ ì´í•´
```python
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from ast import literal_eval
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.feature_extraction.text import CountVectorizer
from sklearn.metrics.pairwise import cosine_similarity
```


í•­ìƒ ì´ ê³¼ì •ì„ ì™œ ì œì¼ ìœ„ì— ì“¸ê¹Œ ìƒê°í–ˆëŠ”ë°, ì´ê±´ ì´ ì½”ë“œë¥¼ ë”°ë¼í•˜ê³  ì½ëŠ” ì‚¬ëŒì„ ìœ„í•œ ë°°ë ¤ë¼ê³  ëŠê¼ˆë‹¤. ë§‰ìƒ ë”°ë¼í• ë ¤ê³  ì½”ë“œë¥¼ Run í–ˆëŠ”ë° ì´ê²ƒë“¤ì´ ì—†ì–´ ìƒê¸±ëŠ” ì—ëŸ¬ë¥¼ ë§Œë‚  ìƒê°í•˜ë‹ˆ ê¹Œë§ˆë“í•˜ë‹¤. ì½”ë“œëŠ” ì½ëŠ” ì‚¬ëŒì„ ë°°ë ¤í•´ì¤˜ì•¼ í•˜ëŠ”ê²ƒ ê°™ë‹¤. ë‚˜ë§Œ ì˜í•´ì„œëŠ” ê·¸ ëˆ„êµ¬ë„ ì•Œì•„ì¤„ ìˆ˜ ì—†ë‹¤.

ğŸ’¡ import ëŠ” ì „ì²´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ê²ƒ, from X import Y ëŠ” X ì—ì„œ í•„ìš”í•œ Y ë§Œ ê°€ì ¸ì˜¤ëŠ” ê²ƒ.
```python
data = pd.read_csv('./movie_data/tmdb_5000_movies.csv')
```

**pd.read_csv()** : ë°ì´í„° íŒŒì¼ì€ csv íŒŒì¼ë¡œ ë§ì´ ì €ì¥ë˜ê³ , csv íŒŒì¼ì„ ì½ëŠ” ë©”ì„œë“œ 
ğŸ‘¨  tmdb_5000_movies.csv ë¼ëŠ” íŒŒì¼ì„ dataë¡œ ì €ì¥í• ê±°ì•¼.

```python
data.head(2)
```

**Dataframe.head(2)** : ë°ì´í„°ì˜ ê°€ì¥ ìœ„ 2ê°œë¥¼ ë³´ì—¬ì¤Œ, ë°ì´í„°ê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ê°„ëµíˆ í™•ì¸
 ğŸ‘¨ ìƒìœ„ 2ê°œì˜ ë°ì´í„°ë¥¼ ë³´ê³ ì‹¶ì–´.

```py
data.shape 
```

**Dataframe.shape** : ë§¤íŠ¸ë¦­ìŠ¤ (row, column) ì„ ë³´ì—¬ì¤Œ, ë°ì´í„°ì˜ í° í¬ë§·ì„ í™•ì¸
ëª‡ê°œì˜ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ ê°€ì¥ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆë‹¤.
 ğŸ‘¨ í¬ë§·ì´ ì–´ë–»ê²Œ ë˜ëŠ”ì§€ ë³´ê³ ì‹¶ì–´, ë°ì´í„°ì˜ í¬ê¸°ë¥¼ ëŒ€ëµì ìœ¼ë¡œ ë³´ê³ ì‹¶ì–´.

```py
data = data[['id','genres', 'vote_average', 'vote_count', 'popularity','title', 'keywords', 'overview']]
```

**Dataframe[["col_name1" , "col_name2"]]** : ë¶ˆ í•„ìš”í•œ ì—´ì„ ì œê±°í•˜ëŠ” ê³¼ì •!
ìš°ë¦¬ê°€ ì•ìœ¼ë¡œ ë‹¤ë£° ë°ì´í„°ë“¤ì€ ëŒ€ë¶€ë¶„ ë°©ëŒ€í•œ ìë£Œë“¤ì„ ë‹´ê³  ìˆê³  êµ‰ì¥íˆ ë‹¤ë“¬ì–´ì§€ì§€ ì•Šì€ ìƒíƒœì˜ ë°ì´í„°ë“¤ì¼ ê²ƒì´ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì—, ìš°ë¦¬ê°€ ë¶„ì„í•˜ë ¤ëŠ” ëª©ì ì„ ì˜ ìƒê°í•˜ê³  í•„ìš”í•œ ë°ì´í„°ë“¤ì„ ì•Œë§ì€ ê·¼ê±°ì™€ í•¨ê»˜ ê³¨ë¼ë‚¼ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥ì´ í•„ìš”í•˜ë‹¤. Recommender System with Python ì—ì„œëŠ” 'Genres'ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì¶”ì²œì„ í•´ì£¼ëŠ” ì‹œìŠ¤í…œì¸ë°, ë¹„ìŠ·í•œ genre ì¤‘ì—ì„œë„ 'vote_count' ì™€ 'vote_average' ë¥¼ ê¸°ë°˜ìœ¼ë¡œ weighted_rating ì„ ê³„ì‚°í•˜ì—¬ ê°€ì¥ ë†’ì€ ì ìˆ˜ì˜ ì˜í™”ë¥¼ ì¶”ì²œí•´ì¤€ë‹¤.
ğŸ‘¨ dataì—ì„œ 'id', 'genres', 'vote_average', 'vote_count', 'popularity','title',  'keywords', 'overview' ë§Œ ë³¼ê±°ì•¼.

```py
m = data['vote_count'].quantile(0.9)
```

**Series.quantile()** : ìƒìœ„ ëª‡í¼ì„¼íŠ¸ì˜ ê°’ì„ ì•Œê³  ì‹¶ì„ ë•Œ 
quantileë¡œ medianì˜ ê°’ì„ ì•„ì£¼ ì‰½ê²Œ ì•Œ ìˆ˜ ìˆë‹¤.
ğŸ‘¨ dataì—ì„œ 'vote_count'ì—ì„œ ìƒìœ„ 10%ê°€ ë˜ëŠ” ê°’ì„ ì•Œê³  ì‹¶ê³  ê·¸ ê°’ì„ m ì— ì €ì¥í• ê±°ì•¼.

```py
data = data.loc[data['vote_count'] >= m]
```

**Dataframe.copy()** : Dataì˜ ì›ë³¸ì„ í•´ì¹˜ì§€ ì•Šê¸° ìœ„í•´ì„œ ë³µì‚¬í•˜ê¸°
**Dataframe.copy()**.loc[data['col_name'] >= value] : íŠ¹ì • ì—´ì—ì„œ íŠ¹ì • ê°’ì´ ì´ìƒì¸ ë°ì´í„°ë§Œ ì¶”ì¶œí•˜ê¸°
ë§ˆì°¬ê°€ì§€ë¡œ ë°ì´í„° ì „ì²˜ë¦¬ ê³¼ì •ì— ê¼­ í•„ìš”í•˜ë‹¤, ì˜ˆë¥¼ë“¤ë©´ outlier ë¥¼ ì œê±° í•  ë•Œ ì“°ì¼ ìˆ˜ë„ ìˆê² ë‹¤.
ğŸ‘¨ dataë¥¼ ìˆ˜ì •í• ê±´ë°, ì´ ë°ì´í„°ëŠ” dataì—ì„œ 'vote_count' ì—´ì˜ ê°’ì´ m ë³´ë‹¤ ê°™ê±°ë‚˜ í° ë°ì´í„°ë§Œ ëª¨ì•„ì„œ ë§Œë“¤ê±°ì•¼.

```py
 C = data['vote_average'].mean()
```

**Series.mean()** : ë°ì´í„°ì˜ í•œ ì—´ì˜ í‰ê· ê°’
í‰ê· ì€ Descriptive statisticsì—ì„œ ì ˆëŒ€ ë¹ ì§€ì§€ ì•ŠëŠ” ê°’ì´ë‹¤.
ğŸ‘¨ c ë¼ëŠ” ë³€ìˆ˜ì—, dataì˜ 'vote_average' ë¼ëŠ” ì—´ì˜ í‰ê· ê°’ì„ ì €ì¥í• ê±°ì•¼.

```py
def weighted_rating(x, m=m, C=C):
    v = x['vote_count']
    R = x['vote_average']
    
    return ( v / (v+m) * R ) + (m / (m + v) * C)
```

ğŸ‘¨  weighted_rating ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì •ì˜ í• ê±´ë°, xëŠ” ìš°ë¦¬ê°€ ë„˜ê²¨ì¤˜ì•¼ í•˜ëŠ” parameter ì´ê³ , mê³¼ C ë¯¸ë¦¬ ì„ ì–¸í•´ì„œ ê°’ì„ ë¯¸ë¦¬ ì •í•´ë†¨ì–´. xëŠ” Dataframeì¼ ê²ƒì´ê³ , vëŠ” ê·¸ ë°ì´í„°ì—ì„œ 'vote_count'ë¼ëŠ” ê°’ì„ ì €ì¥í•˜ê³  Rì€ 'vote_average' ê°’ì„ ì €ì¥í• ê±°ì•¼. ê·¸ë¦¬ê³  í•¨ìˆ˜ë¥¼ í˜¸ì¶œ í–ˆì„ë•Œ ê²°ê³¼ê°’ì€ ( v / (v+m) * R ) + (m / (m + v) * C) ì´ì•¼. 

â“ vì™€ Rì€ Series íƒ€ì…ì¼í…ë°, intì¸ mê³¼ Cë¥¼ í•¨ê»˜ ìˆ˜ì‹ì„ ì§¤ ìˆ˜ ìˆêµ¬ë‚˜. Element-wise ê³„ì‚°ì¸ê°€?

```py
data['score'] = data.apply(weighted_rating, axis = 1)
```
**Dataframe.apply()** : íŠ¹ì • í•¨ìˆ˜ë¥¼ dataì— ì ìš©í•˜ëŠ” ë©”ì„œë“œ, axis=1ì€ each rowì— ì ìš©.
Data manipulation ê³¼ì •ì´ë‹¤. ì‚¬ì‹¤ ë°ì´í„°ì˜ ê°’ë“¤ì€ ìš°ë¦¬ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ ì£¼ì–´ì§€ì§€ ì•ŠëŠ”ë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— í•­ìƒ ì£¼ì–´ì§„ ë°ì´í„°ë“¤ì„ ì´ìš©í•˜ì—¬ ìš°ë¦¬ì˜ ì…ë§›ëŒ€ë¡œ ë°ì´í„°ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆëŠ” ì½”ë“œì´ë‹¤.
ğŸ‘¨ dataì— 'score'ë¼ëŠ” ì—´ì„ ì¶”ê°€ í• ê±´ë°, each rowì— weighted_ratingì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ í†µí•´ì„œ ê³„ì‚°ëœ ê°’ì„ ì €ì¥í•´ì„œ ì¶”ê°€ í• ê±°ì•¼.

ğŸ’¡ ë°ì´í„°ì—ì„œ í•œ row ì—ì„œ ë‹¤ë¥¸ colì˜ ê°’ì„ ì´ìš©í•˜ì—¬ ê³„ì‚°ì„ í•˜ë ¤ë©´ ê°’ì„ ê³„ì‚°í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì €ì¥í•˜ê³ , apply(í•¨ìˆ˜, axis=1)ë¥¼ í†µí•´ì„œ ê°€ëŠ¥í•˜êµ¬ë‚˜.

```py
data['genres'] = data['genres'].apply(literal_eval)
data['keywords'] = data['keywords'].apply(literal_eval)
```

ast.literal_eval : ë¬¸ìì—´ì— ìˆëŠ” ë¬¸êµ¬ë¥¼ ë¬¸ìì—´ ë•Œê³  evaluate í•´ì£¼ëŠ” ë©”ì„œë“œ ex) '{'id':28}' (string)  ğŸ‘‰  {'id':28} (dictionary)
ì–•ì€ ê²½í—˜ìœ¼ë¡œ ë°ì´í„°ë“¤ì€ string ìœ¼ë¡œ ë˜ì–´ìˆì„ ë•Œë¥¼ ìì£¼ ë´¤ì—ˆë‹¤. ì´ë¥¼ í•´ê²°í•´ ì¤„ ìˆ˜ ìˆëŠ” ê°„í¸í•œ ë„êµ¬ì¸ê²ƒ ê°™ë‹¤.
ğŸ‘¨ dataì˜ 'genres'ì™€ 'keywords' ì—´ì´ stringìœ¼ë¡œ ë˜ì–´ìˆëŠ”ë°, stringì„ ë–¼ê³  ê·¸ ê°’ì„ ì½ì–´ì„œ ì €ì¥í•˜ê³  ì‹¶ì–´.

```py
data['genres'] = data['genres'].apply(lambda x : [d['name'] for d in x]).apply(lambda x : " ".join(x))
data['keywords'] = data['keywords'].apply(lambda x : [d['name'] for d in x]).apply(lambda x : " ".join(x))
```
**lambda x : return**  ğŸ‘‰  ì •ì˜ í•˜ì§€ ì•Šì€ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ê³  ì‹¶ì„ ë•Œ 
**list." ".join()** : íŠ¹ì • listì˜ ê°’ì´ stringìœ¼ë¡œ ë˜ì–´ìˆëŠ”ë°, ê·¸ stringì„ space ë¡œ êµ¬ë¶„í•´ì„œ í•˜ë‚˜ì˜ stringìœ¼ë¡œ ì €ì¥
ğŸ‘¨ dataì˜ 'genres'ì™€ 'keywords'ì˜ ê°’ì€ dictionary íƒ€ì…ì´ë‹¤. ê·¸ dictionary ê°’ ì¤‘ì—ì„œ íŠ¹ì • 'key'ì— í•´ë‹¹í•˜ëŠ” ê°’ë§Œ ì‚¬ìš©í•˜ê³  ì‹¶ë‹¤. ê·¸ë˜ì„œ
dataì˜ 'genres'ì™€ 'keywords'ì˜ ê°’ì„ ë³€í˜•í•˜ê³  ì‹¶ì€ë°, dataì˜ 'genres'ì™€ 'keywords' ì—´ì˜ ê°’ì—ì„œ 'name'ì´ë¼ëŠ” keyì˜ ê°’ì„ listë¡œ ì €ì¥í•˜ê³  ì €ì¥ ëœ listì— element ì¸ stringë“¤ì„ spaceë¡œ êµ¬ë¶„í•˜ì—¬ í•˜ë‚˜ì˜ stringìœ¼ë¡œ data 'genres' ì™€ 'keywords' ì—´ì— ì €ì¥!

ğŸ’¡ applyì™€ lambdaë¥¼ í†µí•´ì„œ ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ë°ì´í„° ê°’ ë³€ê²½ì´ ê°€ëŠ¥í•˜êµ¬ë‚˜!
ğŸ’¡ ë°ì´í„° ê°’ì´ dictionary ì–‘ì‹ì¼ ë•Œ, íŠ¹ì • keyì˜ ê°’ë§Œ í•„í„°ë§ í•˜ëŠ” ë°©ë²•
ğŸ’¡ literal_eval ê³¼ apply ì™€ join ì´ ì„¸ê°€ì§€ ê³¼ì •ì´ ìˆë‹¤ëŠ” ê²ƒì„ ì•Œì•„ë‘ë©´ ìœ ìš©í•  ê²ƒ ê°™ë‹¤.

```py
data.to_csv('./movie_data/pre_tmdb_5000_movies.csv', index = False)
```

**Dataframe.to_csv()** : Dataframeì„ csv íŒŒì¼ë¡œ ì €ì¥ 
ğŸ‘¨ dataë¼ëŠ” ë°ì´í„°ë¥¼ ./movie_data/pre_tmdb_5000_movies.csv ìœ¼ë¡œ ì¸ë±ìŠ¤ ì—†ì´ ì €ì¥

